import{c as j,j as t,d as v,r as h}from"./index-CQ6O1lHB.js";import{L as _}from"./loader-circle-kidr4Hbv.js";import{C as g}from"./circle-alert-CUD5vOFW.js";import{s as f}from"./supabaseClient-CKZMtVZ1.js";const N=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],P=j("circle-check-big",N);function k(a,n={}){window.posthog?.capture&&window.posthog.capture(a,{event_id:crypto.randomUUID(),...n})}function q(a,n={}){window.fbq&&(["PageView","AddToCart","Purchase","InitiateCheckout"].includes(a)?window.fbq("track",a,n):window.fbq("trackCustom",a,n))}function b(a,n={}){window.gtag&&window.gtag("event",a,n)}function I(a,n={}){window.pintrk&&window.pintrk("track",a,n)}function x(a){const{orderId:n,value:o,currency:s,items:c}=a;k("Purchase",{order_id:n,value:o,currency:s,items:c}),c.forEach(e=>{k("Purchase_Item",{order_id:n,product_id:e.id,product_name:e.name,product_quantity:e.quantity,product_price:e.price})}),q("Purchase",{value:o,currency:s,transaction_id:n,contents:c.map(e=>({id:e.id,quantity:e.quantity,item_price:e.price})),content_type:"product"}),b("purchase",{transaction_id:n,value:o,currency:s,items:c.map(e=>({item_id:e.id,item_name:e.name,price:e.price,quantity:e.quantity}))}),I("checkout",{value:o,order_id:n,currency:s,line_items:c.map(e=>({product_id:e.id,product_quantity:e.quantity,product_price:e.price}))}),b("CompletePayment",{contents:c.map(e=>({content_id:e.id,content_name:e.name,quantity:e.quantity,price:e.price})),value:o,currency:s,order_id:n})}const A=({loading:a,error:n,purchaseData:o,onRetry:s})=>t.jsx("div",{"data-component-start":"11:2:329","data-component-end":"21:8:3033","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"max-w-2xl w-full bg-white rounded-lg shadow-md p-8 text-center",className:"max-w-2xl w-full bg-white rounded-lg shadow-md p-8 text-center",children:a?t.jsxs("div",{"data-component-start":"13:6:433","data-component-end":"13:173:600","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"text-center",className:"text-center",children:[t.jsx(_,{"data-component-start":"13:35:462","data-component-end":"13:108:535","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"Loader2","data-component-class":"h-12 w-12 animate-spin text-blue-600 mx-auto mb-4",className:"h-12 w-12 animate-spin text-blue-600 mx-auto mb-4"}),t.jsx("p",{"data-component-start":"13:108:535","data-component-end":"13:167:594","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"p","data-component-class":"text-gray-600",className:"text-gray-600",children:"Verificando informações..."})]}):n?t.jsxs(t.Fragment,{children:[t.jsx(g,{"data-component-start":"15:8:627","data-component-end":"15:71:690","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"AlertCircle","data-component-class":"h-16 w-16 text-red-500 mx-auto mb-4",className:"h-16 w-16 text-red-500 mx-auto mb-4"}),t.jsx("h1",{"data-component-start":"15:71:690","data-component-end":"15:145:764","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"h1","data-component-class":"text-2xl font-bold text-gray-900 mb-2",className:"text-2xl font-bold text-gray-900 mb-2",children:"Falha na Compra"}),t.jsx("div",{"data-component-start":"15:145:764","data-component-end":"15:287:906","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:t.jsx("p",{"data-component-start":"15:214:833","data-component-end":"15:281:900","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"p","data-component-class":"text-red-600 text-sm",className:"text-red-600 text-sm",children:`Erro: ${n?.message}`})}),t.jsx("button",{"data-component-start":"15:287:906","data-component-end":"15:428:1047","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"button","data-component-class":"bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors",onClick:s,className:"bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"Tentar Novamente"})]}):o?t.jsxs(t.Fragment,{children:[t.jsx(P,{"data-component-start":"19:8:1327","data-component-end":"19:73:1392","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"CheckCircle","data-component-class":"h-16 w-16 text-green-500 mx-auto mb-4",className:"h-16 w-16 text-green-500 mx-auto mb-4"}),t.jsx("h1",{"data-component-start":"19:73:1392","data-component-end":"19:149:1468","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"h1","data-component-class":"text-2xl font-bold text-gray-900 mb-2",className:"text-2xl font-bold text-gray-900 mb-2",children:"Compra Realizada!"}),t.jsx("p",{"data-component-start":"19:149:1468","data-component-end":"19:239:1558","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"p","data-component-class":"text-gray-600 mb-6",className:"text-gray-600 mb-6",children:"Obrigado pela sua compra, seu pedido foi confirmado."}),o.products&&o.products.length>0?t.jsx("div",{"data-component-start":"19:301:1620","data-component-end":"19:1434:2753","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"space-y-4",className:"space-y-4",children:t.jsxs("div",{"data-component-start":"19:328:1647","data-component-end":"19:1428:2747","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6 shadow-sm",className:"bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6 shadow-sm",children:[t.jsxs("h3",{"data-component-start":"19:440:1759","data-component-end":"19:596:1915","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"h3","data-component-class":"text-lg font-semibold text-green-800 mb-4",className:"text-lg font-semibold text-green-800 mb-4",children:["Seu Pedido (",o.products.length," item",o.products.length>1?"s":"",")"]}),t.jsx("div",{"data-component-start":"19:596:1915","data-component-end":"19:970:2289","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"space-y-3 mb-6",className:"space-y-3 mb-6",children:o.products.map((c,e)=>t.jsx("div",{"data-component-start":"19:693:2012","data-component-end":"19:961:2280","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-map-start":"19:629:1948","data-component-map-end":"19:963:2282","data-component-class":"bg-white/60 rounded-lg p-4 border border-green-200",className:"bg-white/60 rounded-lg p-4 border border-green-200",children:t.jsx("div",{"data-component-start":"19:773:2092","data-component-end":"19:955:2274","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"flex items-center justify-between",className:"flex items-center justify-between",children:t.jsx("div",{"data-component-start":"19:824:2143","data-component-end":"19:949:2268","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"flex-1",className:"flex-1",children:t.jsx("h4",{"data-component-start":"19:848:2167","data-component-end":"19:943:2262","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"h4","data-component-class":"font-medium text-green-800",className:"font-medium text-green-800",children:c.productName||`Produto ${e+1}`})})})},e))}),t.jsxs("div",{"data-component-start":"19:970:2289","data-component-end":"19:1422:2741","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"space-y-3",className:"space-y-3",children:[t.jsx("a",{"data-component-start":"19:997:2316","data-component-end":"19:1214:2533","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"a","data-component-class":"w-full bg-brand-primary text-white px-6 py-3 rounded-lg hover:bg-brand-primary/90 transition-colors flex items-center justify-center gap-2 no-underline font-medium",href:"/account",className:"w-full bg-brand-primary text-white px-6 py-3 rounded-lg hover:bg-brand-primary/90 transition-colors flex items-center justify-center gap-2 no-underline font-medium",children:"Ir para Meu Portal"}),t.jsx("a",{"data-component-start":"19:1214:2533","data-component-end":"19:1416:2735","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"a","data-component-class":"w-full bg-gray-200 text-gray-800 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors flex items-center justify-center gap-2 no-underline font-medium",href:"/",className:"w-full bg-gray-200 text-gray-800 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors flex items-center justify-center gap-2 no-underline font-medium",children:"Voltar para o Início"})]})]})}):null,t.jsx("div",{"data-component-start":"19:1443:2762","data-component-end":"19:1695:3014","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"mt-8 pt-6 border-t border-gray-200",className:"mt-8 pt-6 border-t border-gray-200",children:o.checkoutSessionId&&t.jsx("div",{"data-component-start":"19:1531:2850","data-component-end":"19:1687:3006","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"div","data-component-class":"mb-4",className:"mb-4",children:t.jsxs("p",{"data-component-start":"19:1553:2872","data-component-end":"19:1681:3000","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"p","data-component-class":"text-sm font-mono text-gray-800 bg-gray-100 px-3 py-2 rounded border",className:"text-sm font-mono text-gray-800 bg-gray-100 px-3 py-2 rounded border",children:["Pedido: ",o.checkoutSessionId]})})})]}):t.jsxs(t.Fragment,{children:[t.jsx(g,{"data-component-start":"17:8:1085","data-component-end":"17:74:1151","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"AlertCircle","data-component-class":"h-16 w-16 text-yellow-500 mx-auto mb-4",className:"h-16 w-16 text-yellow-500 mx-auto mb-4"}),t.jsx("h1",{"data-component-start":"17:74:1151","data-component-end":"17:158:1235","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"h1","data-component-class":"text-2xl font-bold text-gray-900 mb-2",className:"text-2xl font-bold text-gray-900 mb-2",children:"Informação não encontrada"}),t.jsx("p",{"data-component-start":"17:158:1235","data-component-end":"17:228:1305","data-component-path":"src/react-app/components/Checkout/CheckoutSuccessContent.tsx","data-component-file":"CheckoutSuccessContent.tsx","data-component-name":"p","data-component-class":"text-gray-600",className:"text-gray-600",children:"Verifique se o sessionId está correto"})]})}),V=()=>{const[a]=v(),[n,o]=h.useState(!0),[s,c]=h.useState(null),[e,u]=h.useState(null),l=a.get("sessionId");return h.useEffect(()=>{if(!l){u({message:"Missing sessionId parameter"}),o(!1);return}(async()=>{o(!0);const{data:r,error:L}=await f.from("orders").select("*").eq("session_id",l).single();if(r)c(r),u(null),x&&x({orderId:r.checkout_session_id||r.session_id,value:r.total_amount,currency:r.currency,items:Array.isArray(r.products)?r.products.map(p=>({id:p.id,name:p.name,price:p.price,quantity:p.quantity})):[]});else{const p=localStorage.getItem("cart");let i=[];try{i=p?JSON.parse(p):[]}catch{}if(i&&i.length>0){const y=i.reduce((m,C)=>m+C.price*C.quantity,0),S={session_id:l,products:i,total_amount:y,currency:"BRL",created_at:new Date().toISOString()},{data:d,error:w}=await f.from("orders").insert([S]).select("*").single();d?(c(d),u(null),localStorage.removeItem("cart"),x&&x({orderId:d.checkout_session_id||d.session_id,value:d.total_amount,currency:d.currency,items:Array.isArray(d.products)?d.products.map(m=>({id:m.id,name:m.name,price:m.price,quantity:m.quantity})):[]})):(u({message:w?.message||"Erro ao registrar pedido."}),c(null))}else u({message:"Pedido não encontrado e carrinho vazio."}),c(null)}o(!1)})()},[l]),t.jsx("div",{"data-component-start":"150:4:5171","data-component-end":"152:10:5390","data-component-path":"src/react-app/pages/CheckoutSuccessPage.tsx","data-component-file":"CheckoutSuccessPage.tsx","data-component-name":"div","data-component-class":"min-h-screen bg-gray-50 flex items-center justify-center",className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsx(A,{"data-component-start":"151:6:5252","data-component-end":"151:133:5379","data-component-path":"src/react-app/pages/CheckoutSuccessPage.tsx","data-component-file":"CheckoutSuccessPage.tsx","data-component-name":"CheckoutSuccessContent",loading:n,error:e,purchaseData:s,onRetry:()=>window.location.reload()})})};export{V as default};
